# テスト仕様書

本プロジェクトの自動テスト（検証スクリプト）に関する仕様と実行方法を記述します。

## 1. テスト環境

- **実行場所**: `tests/` ディレクトリ配下のスクリプトを使用
- **依存関係**: プロジェクトの仮想環境 (`.venv`)

## 2. テスト一覧

### 2.1. ログ機能の検証 (`tests/verify_logging.py`)

- **目的**: `automator.py` が `--log-file` および `--log-level` オプションを正しく処理し、ログファイルを出力することを確認する。
- **テスト内容**:
  1.  ダミーの `actions.csv` を作成。
  2.  `automator.py` を `--log-file` 指定で実行。
  3.  生成されたログファイルを読み込み、特定のログメッセージ（"Loading actions", "Waiting" など）が含まれているか確認。
- **期待される結果**:
  - ログファイルが作成されること。
  - ログファイル内に期待されるメッセージが存在すること。
  - スクリプトが "Logging Verification: PASS" を出力して終了すること。

### 2.2. Dry-run モードの検証 (`tests/verify_dry_run.py`)

- **目的**: `automator.py` が `--dry-run` オプション指定時に、副作用のある操作（アプリ起動、クリック等）をスキップし、その旨をログ出力することを確認する。
- **テスト内容**:
  1.  メモ帳を起動するアクションを含むダミーの `actions.csv` を作成。
  2.  `automator.py` を `--dry-run` 指定で実行。
  3.  ログファイルを解析し、"[Dry-run] Would launch" などのメッセージが出力されているか確認。
- **期待される結果**:
  - 実際にアプリが起動しないこと（実行時間が極端に短いことで間接的に検証）。
  - ログに "[Dry-run]" プレフィックス付きのメッセージが記録されること。
  - スクリプトが "Dry-run Verification: PASS" を出力して終了すること。

### 2.3. スクリーンショット機能の検証 (`tests/verify_screenshot.py`)

- **目的**: アクション実行中にエラーが発生した場合、自動的にスクリーンショットが保存されることを確認する。
- **テスト内容**:
  1.  存在しないウィンドウを操作しようとする（必ず失敗する）ダミーの `actions.csv` を作成。
  2.  `automator.py` を実行。
  3.  `errors/` ディレクトリ内のファイル数をカウントし、実行後に増えているか確認。
- **期待される結果**:
  - `automator.py` がエラーで終了（またはエラーログを出力）すること。
  - `errors/` ディレクトリに新しい `.png` ファイルが生成されること。
  - スクリプトが "Screenshot Verification: PASS" を出力して終了すること。

## 3. テスト実行方法

以下のコマンドですべての検証スクリプトを実行できます。

```bash
python tests/verify_logging.py
python tests/verify_dry_run.py
python tests/verify_screenshot.py
```
